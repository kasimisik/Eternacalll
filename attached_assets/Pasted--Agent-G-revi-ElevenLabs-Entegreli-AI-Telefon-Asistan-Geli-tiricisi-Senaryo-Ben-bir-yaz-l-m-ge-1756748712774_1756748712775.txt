ğŸ¯ Agent GÃ¶revi: ElevenLabs Entegreli AI Telefon AsistanÄ± GeliÅŸtiricisi
Senaryo: Ben bir yazÄ±lÄ±m geliÅŸtiricisiyim. ElevenLabs'in Conversational AI (Sohbet Eden Yapay Zeka) Ã¶zelliklerini kullanarak, kullanÄ±cÄ±larÄ±n kendi sesli AI asistanlarÄ±nÄ± (agent) oluÅŸturup bir telefon numarasÄ±na baÄŸlayabildiÄŸi bir SaaS platformu (yazÄ±lÄ±m-hizmeti) oluÅŸturuyorum. TÃ¼m AI ve ses iÅŸlemleri iÃ§in sadece ElevenLabs API'sini kullanacaÄŸÄ±z. Twilio, OpenAI, Anthropic, Deepgram gibi diÄŸer tÃ¼m servislere Ä°HTÄ°YACIMIZ YOK.

Senin Temel GÃ¶revin: Bu projeyi hayata geÃ§irmek iÃ§in ihtiyaÃ§ duyduÄŸum tÃ¼m backend (Next.js API route'larÄ±) ve frontend (React bileÅŸenleri) kodlarÄ±nÄ±, aÅŸaÄŸÄ±daki detaylÄ± talimatlara uygun ÅŸekilde yazmak.

ğŸ“‹ Proje Mimari Ã–zeti (Yeni & BasitleÅŸtirilmiÅŸ)
KullanÄ±cÄ± AkÄ±ÅŸÄ± (Sizin Dashboard'Ä±nÄ±z):

KullanÄ±cÄ±, sizin arayÃ¼zÃ¼nÃ¼zde bir AI agent oluÅŸturur.

Form AlanlarÄ±: Agent Ä°smi, Sistem Promutu (Agent'Ä±n nasÄ±l davranacaÄŸÄ±), Ses SeÃ§imi (ElevenLabs'ten ses listesi veya ses yÃ¼kleme/cloning), Ä°nce ayarlar (Stability, Clarity), BaÄŸlanacak Telefon NumarasÄ±.

KullanÄ±cÄ± "Kaydet"e bastÄ±ÄŸÄ±nda, sizin backend'iniz ElevenLabs API'sine gidip bu agentÄ± oluÅŸturur ve dÃ¶nen agent_id'yi kendi veritabanÄ±nÄ±za kaydeder.

Telefon numarasÄ± saÄŸlayÄ±cÄ±sÄ±nÄ±n (SIP trunk) ayarlarÄ±ndan, o numaraya gelen Ã§aÄŸrÄ±larÄ±n ElevenLabs'teki ilgili agent_id'nin Ã¶zel endpoint'ine (https://api.elevenlabs.io/v1/agents/[agent_id]/answer) yÃ¶nlendirilmesi saÄŸlanÄ±r. BU KISIM MANUEL BÄ°R AYARDIR, SENÄ°N KODUNUN DIÅINDADIR.

Ã‡aÄŸrÄ± AkÄ±ÅŸÄ± (ElevenLabs TarafÄ±nda):

Birisi numarayÄ± arar.

Ã‡aÄŸrÄ±, otomatik olarak ElevenLabs'e yÃ¶nlendirilir.

ElevenLabs, agent'Ä±n prompt'unu ve ses ayarlarÄ±nÄ± yÃ¼kler.

ElevenLabs, kendi iÃ§inde konuÅŸmayÄ± metne Ã§evirir (STT), AI ile yanÄ±tÄ± oluÅŸturur, ve yanÄ±tÄ± metni sese Ã§evirir (TTS).

Ses, arayan kiÅŸiye iletilir.

Ã–NEMLÄ°: Bu sÃ¼reÃ§ iÃ§in sizin bir /api/twilio/call-handler yazmanÄ±za GEREK YOK. TÃ¼m Ã§aÄŸrÄ± mantÄ±ÄŸÄ± ElevenLabs'te.

ğŸ‘¨â€ğŸ’» Senden Ä°stenen Kodlar (Senin Yapman Gerekenler)
AmaÃ§: KullanÄ±cÄ±nÄ±n agent oluÅŸturup yÃ¶netebileceÄŸi bir dashboard yapmak.

1. Backend - Next.js API Route'larÄ± ( /pages/api/ veya /app/api/ )

/api/voices/list (GET):

ElevenLabs'in GET /v1/voices endpoint'ini Ã§aÄŸÄ±racak.

KullanÄ±cÄ±ya, ses listesini (isim, ID, Ã¶rnek vs.) dÃ¶ndÃ¼recek.

Gereklilik: ElevenLabs API key'i gÃ¼venli bir ÅŸekilde (.env dosyasÄ±ndan) yÃ¼klenmeli.

/api/voices/clone (POST):

ElevenLabs'in POST /v1/voices/add endpoint'ini kullanacak.

KullanÄ±cÄ±dan bir ses dosyasÄ± ve isim alacak, bunu ElevenLabs'e gÃ¶nderip yeni bir voice_id oluÅŸturacak.

OluÅŸan voice_id'yi frontend'e dÃ¶ndÃ¼recek.

/api/agents/create (POST):

Bu en Ã¶nemli endpoint. Frontend'den gelen verileri alacak:

json
{
  "name": "Ahmet'in RestoranÄ±",
  "prompt": "Sen dost canlÄ±sÄ± bir restoran resepsiyonistisin...",
  "voice_id": "abc123...",
  "stability": 0.7,
  "similarity_boost": 0.8
  // ...diÄŸer ayarlar
}
ElevenLabs'in POST /v1/agents endpoint'ini Ã§aÄŸÄ±racak ve yukarÄ±daki verileri iletecek.

ElevenLabs'ten dÃ¶nen agent_id'yi kendi veritabanÄ±nÄ±za (Ã¶rneÄŸin Neon PostgreSQL) kaydedecek. (VeritabanÄ± ÅŸemasÄ±: agents(id, user_id, name, elevenlabs_agent_id, created_at))

BaÅŸarÄ± yanÄ±tÄ± dÃ¶necek.

/api/agents/list (GET):

KullanÄ±cÄ±nÄ±n oluÅŸturduÄŸu tÃ¼m agent'larÄ± kendi veritabanÄ±nÄ±zdan Ã§ekip frontend'e listeleyecek.

2. Frontend - React BileÅŸenleri (Dashboard)

VoiceSelector.jsx: ElevenLabs'ten gelen ses listesini gÃ¶steren bir dropdown/lista bileÅŸeni. /api/voices/list'i kullanacak.

VoiceCloner.jsx: KullanÄ±cÄ±nÄ±n ses dosyasÄ± yÃ¼kleyip klonlama yapabileceÄŸi bir form bileÅŸeni. /api/voices/clone'u kullanacak.

AgentCreator.jsx: Ana form bileÅŸeni. KullanÄ±cÄ±dan agent bilgilerini (isim, prompt) alacak, yukarÄ±daki ses bileÅŸenlerini iÃ§erecek, ve tÃ¼m veriyi /api/agents/create'e gÃ¶nderecek.

AgentsList.jsx: KullanÄ±cÄ±nÄ±n oluÅŸturduÄŸu agent'larÄ± listeleyecek, dÃ¼zenleme/silme butonlarÄ± olacak.

âš™ï¸ Teknik Gereksinimler & Kurallar
Dil: Next.js (App Router tercih edilir), React.

HTTP Ä°stemcisi: fetch API veya axios.

VeritabanÄ±: Neon (PostgreSQL). Basit bir tablo yeterli (agents).

ORM: Drizzle ORM veya direkt pg package'i kullanÄ±labilir.

Kimlik DoÄŸrulama: Clerk.dev. TÃ¼m API route'larÄ±, Clerk'in auth() helper'Ä± ile korunmalÄ±. Sadece giriÅŸ yapmÄ±ÅŸ kullanÄ±cÄ±lar agent oluÅŸturabilmeli.

Ã‡evre DeÄŸiÅŸkenleri: ElevenLabs API Key (ELEVENLABS_API_KEY) kesinlikle .env.local dosyasÄ±nda saklanmalÄ± ve asla frontend'e gÃ¶nderilmemeli.

Hata YÃ¶netimi: TÃ¼m API route'larÄ± try-catch bloklarÄ± iÃ§inde olmalÄ±. ElevenLabs'ten veya veritabanÄ±ndan gelecek hatalar kullanÄ±cÄ±ya anlaÅŸÄ±lÄ±r bir ÅŸekilde iletilmeli (Ã¶rneÄŸin: "Ses oluÅŸturulurken bir hata oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.").

ğŸš¨ Ã–zel Talimatlar
KODU AÃ‡IKLA: Ã–nemli fonksiyonlarÄ±n ve karmaÅŸÄ±k mantÄ±klarÄ±n Ã¼zerine yorum satÄ±rlarÄ± yaz.

MODÃœLER YAZ: KodlarÄ± tekrar kullanÄ±labilir bileÅŸenler ve fonksiyonlar halinde yaz. (Ã–rn: lib/elevenlabs.js adÄ±nda bir dosya oluÅŸturup tÃ¼m ElevenLabs API Ã§aÄŸrÄ±larÄ±nÄ± oraya toplayabilirsin).

GÃœVENLÄ°K: API Key'i asla aÃ§Ä±kta bÄ±rakma. Clerk kimlik doÄŸrulamasÄ±nÄ± her API route iÃ§in kullan.

KULLANICI DOSTU: Frontend'de yÃ¼kleme durumlarÄ± (loading state), hata mesajlarÄ± ve baÅŸarÄ± bildirimleri mutlaka olsun.

Ã–rnek Kod ParÃ§asÄ± (API Route - /api/agents/create):

javascript
// app/api/agents/create/route.js
import { NextResponse } from 'next/server';
import { auth } from '@clerk/nextjs';
import { db } from '@/lib/db'; // VeritabanÄ± baÄŸlantÄ±n
import { agents } from '@/lib/db/schema'; // Drizzle ORM ÅŸeman

export async function POST(request) {
  try {
    // 1. KullanÄ±cÄ±yÄ± doÄŸrula
    const { userId } = auth();
    if (!userId) {
      return new NextResponse("Unauthorized", { status: 401 });
    }

    // 2. Frontend'den gelen veriyi al
    const body = await request.json();
    const { name, prompt, voice_id, stability, similarity_boost } = body;

    // 3. ElevenLabs'te Agent OluÅŸtur
    const elevenLabsResponse = await fetch('https://api.elevenlabs.io/v1/agents', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'xi-api-key': process.env.ELEVENLABS_API_KEY,
      },
      body: JSON.stringify({
        name: name,
        prompt: prompt,
        voice_id: voice_id,
        settings: {
          stability: stability,
          similarity_boost: similarity_boost,
        },
      }),
    });

    if (!elevenLabsResponse.ok) {
      throw new Error('ElevenLabs agent creation failed');
    }

    const elevenLabsData = await elevenLabsResponse.json();
    const elevenLabsAgentId = elevenLabsData.agent_id;

    // 4. Agent'Ä± kendi veritabanÄ±na kaydet
    const [newAgent] = await db.insert(agents).values({
      userId: userId,
      name: name,
      elevenlabsAgentId: elevenLabsAgentId,
    }).returning();

    // 5. BaÅŸarÄ±yla sonuÃ§ dÃ¶ndÃ¼r
    return NextResponse.json(newAgent, { status: 201 });

  } catch (error) {
    console.log('[AGENT_POST]', error);
    return new NextResponse("Internal Error", { status: 500 });
  }
}
Åimdi gÃ¶revim, yukarÄ±da Ã¶zetlenen tÃ¼m bu API route'larÄ±nÄ± ve frontend bileÅŸenlerini, veritabanÄ± ÅŸemasÄ±nÄ± ve entegrasyonlarÄ± iÃ§eren eksiksiz bir proje oluÅŸturmak. Ä°ÅŸe baÅŸlayabilirim.

