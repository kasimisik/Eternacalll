Prompt BaÅŸlÄ±ÄŸÄ±: â€œNetgsm SIP Voice Agent (Azure + Anthropic)â€

AmaÃ§:
Netgsm SIP bilgileriyle doÄŸrudan register olan, gelen Ã§aÄŸrÄ±yÄ± karÅŸÄ±layÄ±p gerÃ§ek zamanlÄ± konuÅŸan bir AI asistan geliÅŸtirmek.

AdÄ±mlar:

SIP Register:

SIP host, username, password bilgilerini config dosyasÄ±ndan al.

sip.js veya drachtio kullanarak Netgsmâ€™e REGISTER ol.

REGISTER baÅŸarÄ±lÄ±ysa logla.

Gelen Ã‡aÄŸrÄ± (INVITE):

INVITE alÄ±ndÄ±ÄŸÄ±nda otomatik cevapla (200 OK).

RTP media streamâ€™ini aÃ§.

STT (Azure):

RTPâ€™den gelen sesi PCMâ€™e Ã§evir.

Azure Speech SDK ile anlÄ±k olarak textâ€™e dÃ¶nÃ¼ÅŸtÃ¼r.

LLM (Anthropic):

KullanÄ±cÄ±nÄ±n textâ€™ini Anthropic APIâ€™ye gÃ¶nder.

Context: â€œSen KasÄ±mâ€™Ä±n kiÅŸisel sesli asistanÄ±sÄ±n. Telefonda karÅŸÄ±lÄ±klÄ± konuÅŸma yapÄ±yorsun.â€

YanÄ±tÄ± al.

TTS (Azure):

Anthropic yanÄ±tÄ±nÄ± Azure TTS ile sese Ã§evir.

RTP Ã¼zerinden arayana geri gÃ¶nder.

Loop:

KullanÄ±cÄ± konuÅŸtu â†’ STT â†’ LLM â†’ TTS â†’ Ses geri gÃ¶nder â†’ Devam et.

Notlar:

Ses codec: Netgsm genelde PCMA (G711A) veya PCMU kullanÄ±yor.

STT/TTS iÃ§in wav veya pcm16 formatÄ± kullan.

Replitâ€™te UDP aÃ§mak zor olabilir â†’ o yÃ¼zden sip.js WebSocket SIP proxy (Ã¶r: wss) gerekebilir.

EÄŸer UDP engellenirse â†’ drachtio
 veya pjsip tabanlÄ± kÃ¼Ã§Ã¼k bir server kullan.

ðŸ§‘â€ðŸ’» Ã–rnek Node.js Kod Ä°skeleti

(SIP register + Ã§aÄŸrÄ± karÅŸÄ±lama iÃ§in sip.js)

import SIP from "sip";
import { AzureSTT, AzureTTS } from "./azure.js";
import { askAnthropic } from "./anthropic.js";

const config = {
  uri: "sip:905xxxxxxx@sip.netgsm.com.tr",
  ws_servers: "wss://sip.netgsm.com.tr",
  authorizationUser: "905xxxxxxx",
  password: "SIP_PASSWORD",
  displayName: "AI Agent"
};

// 1. Register
const ua = new SIP.UA(config);

ua.on("invite", async (session) => {
  console.log("ðŸ“ž Gelen Ã§aÄŸrÄ±!");
  session.accept();

  // 2. Media stream yakala
  session.on("trackAdded", () => {
    const pc = session.sessionDescriptionHandler.peerConnection;
    const remoteStream = new MediaStream();
    pc.getReceivers().forEach(r => remoteStream.addTrack(r.track));

    // Burada remoteStream â†’ Azure STT
  });

  // 3. KullanÄ±cÄ±dan text geldiÄŸinde â†’ Anthropic â†’ Azure TTS â†’ ses gÃ¶nder
  async function handleConversation(text) {
    const reply = await askAnthropic(text);
    const audioBuffer = await AzureTTS(reply);
    session.sessionDescriptionHandler.send(audioBuffer);
  }
});